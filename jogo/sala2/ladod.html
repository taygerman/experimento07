<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posicionar Elemento</title>
    <style> 
        
        * {
            margin: 0;
        }

        section {
            background-image: url('../img/fundo.png'); 
            background-size: cover;
            height: 100vh;

            display: flex;
            justify-content: flex-end;
            align-items: flex-end;
        }

        #labirinto {
            height: 50%;
            width: 50%;
            
            background-image:url('../img/fechado.png');
            background-size: cover; 
            background-repeat: no-repeat;
        }

        #bola {
            position: absolute;
            
            left: 5%;
            top: 93%;
        }

        .canto {
            
            position: absolute;
            bottom: 0;
            right: 0;
            
            width: 50%;
            height: 50%;
            
            background-size: contain;
            background-repeat: no-repeat;
        }

        .centro {
            position: absolute;
            
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            
            background-size: contain;
            background-repeat: no-repeat;
        }

    </style>
</head>
<body>
    <section>
        <div class="vertical canto" id="labirinto" onclick="mesa()">
            <img src="" id="final" ><!-- o final do labirido eu vou ver se a bola esta sobre para chegar o final posso mudar para verificar as cordenadas-->
            <img src="../img/bola.png" id="bola"><!-- a bola que vai se mover conforme as forças das setas-->
        </div>
    </section>

    <script>

        let labirinto = document.getElementById('labirinto');
        let setasCriadas = false;

        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                labirinto.classList.remove('centro');
                labirinto.classList.add('canto');
                labirinto.style.backgroundImage = 'url("../img/fechado.png")';  
                labirinto.style.width = '50%'; 
                labirinto.style.height = '50%';
                
                const container = document.getElementsByTagName("section")[0];
                const setas = container.querySelectorAll('img.horizontal, img.vertical');
                setas.forEach(seta => container.removeChild(seta));
            }

            if (event.key === "s") {
                comecar()
            }

            if (event.key === "Enter") {
                console.log('queijo')
                executar()
            }
        });

        function mesa() {
            labirinto.classList.remove('canto');
            labirinto.classList.add('centro');
            labirinto.style.backgroundImage = 'url("../img/labirinto.png")';
            labirinto.style.width = '700px'; 
            labirinto.style.height = '600px';
            alert('aperte esc para sair, aperte s para começar e enter para executar')

            if (!setasCriadas) {
                const container = document.getElementsByTagName("section")[0];

                const direita = document.createElement("img");
                direita.src = "../img/setas/1d.png";
                direita.className = "horizontal";
                direita.id = "direita";
                direita.onclick = function() { mudard(); };
                container.appendChild(direita);

                const esquerda = document.createElement("img");
                esquerda.src = "../img/setas/1e.png";
                esquerda.className = "horizontal";
                esquerda.id = "esquerda";
                esquerda.onclick = function() { mudare(); };
                container.appendChild(esquerda);

                const cima = document.createElement("img");
                cima.src = "../img/setas/1c.png";
                cima.className = "vertical";
                cima.id = "cima";
                cima.onclick = function() { mudarc(); };
                container.appendChild(cima);

                const baixo = document.createElement("img");
                baixo.src = "../img/setas/1b.png";
                baixo.className = "vertical";
                baixo.id = "baixo";
                baixo.onclick = function() { mudarb(); };
                container.appendChild(baixo);

                setasCriadas = true;
            }
        }

        function comecar() {
            let direita = document.getElementById('direita');
            let numd = Math.floor((Math.random() * 9)) + 1
            direita.src = "../img/setas/" + numd + "d.png";

            let esquerda = document.getElementById('esquerda');
            let nume = Math.floor((Math.random() * 9)) + 1
            esquerda.src = "../img/setas/" + nume + "e.png";
            
            let cima = document.getElementById('cima');
            let numc = Math.floor((Math.random() * 9)) + 1
            cima.src = "../img/setas/" + numc + "c.png";

            let baixo = document.getElementById('baixo');
            let numb = Math.floor((Math.random() * 9)) + 1
            baixo.src = "../img/setas/" + numb + "b.png";
        }

        function logd () { 
            let direita = document.getElementById('direita');
            let srcD = direita.src;
            let num = srcD.match(/(\d+)d\.png$/);
            return num
        }

        function loge () {
            let esquerda = document.getElementById('esquerda');
            let srcE = esquerda.src;
            let num = srcE.match(/(\d+)e\.png$/);
            return num
        }

        function logc () {
            let cima = document.getElementById('cima');
            let srcC = cima.src;
            let num = srcC.match(/(\d+)c\.png$/);
            return num
        }

        function logb () {
            let baixo = document.getElementById('baixo');
            let srcB = baixo.src;
            let num = srcB.match(/(\d+)b\.png$/);
            return num
        }


        function mudard() {
            let num = logd();
            let numd = parseInt(num[1]) + 1;
            let direita =document.getElementById('direita');
            if (numd > 10) {numd = 1};
            direita.src = "../img/setas/" + numd + "d.png";
        }
        
        function mudare() {
            let num = loge();
            let nume = parseInt(num[1]) + 1;
            let esquerda =document.getElementById('esquerda');
            if (nume > 10) {nume = 1};
            esquerda.src = "../img/setas/" + nume + "e.png";
        }

        function mudarc() {
            let num = logc();
            let numc = parseInt(num[1]) + 1;
            let cima =document.getElementById('cima');
            if (numc > 10) {numc = 1};
            cima.src = "../img/setas/" + numc + "c.png";
        }
        function mudarb() {
            let num = logb();
            let numb = parseInt(num[1]) + 1;
            let baixo =document.getElementById('baixo');
            if (numb > 10) {numb = 1};
            baixo.src = "../img/setas/" + numb+ "b.png";
        }

// eu sei que tá ruim mas fazer por propiedades da imagem eu não entendi
        function parede(a,b) {
            let mover = true;
            let horizontal = a;
            let vertical = b;

            console.log(horizontal)
            console.log(vertical)
            console.log(mover)

            if (horizontal == 5 && vertical <= 93 && vertical >= 69) {mover = true;}; 
            if (vertical == 69 && horizontal >= 5 && horizontal <= 25) {mover = true;}; 
            if (horizontal == 25 && vertical <= 81 && vertical >= 69) {mover = true;}; 
            if (vertical == 81 && horizontal >= 25 && horizontal <= 45) {mover = true;};
            if (vertical == 75 && horizontal >= 45 && horizontal <= 65) {mover = true;}; 
            if (horizontal == 45 && vertical <= 81 && vertical >= 45) {mover = true;}; 
            if (vertical == 45 && horizontal >= 30 && horizontal <= 65) {mover = true;}; 
            if (horizontal == 30 && vertical <= 45 && vertical >= 9) {mover = true;}; 
            if (vertical == 9 && horizontal >= 30 && horizontal <= 90) {mover = true;}; 
            if (horizontal == 90 && vertical <= 57 && vertical >= 9) {mover = true;}; 
            if (vertical == 9 && horizontal >= 65 && horizontal <= 90) {mover = true;}; 
            if (horizontal == 65 && vertical >= 45 && vertical <= 57) {mover = true;}; 
            return mover

        }

        function posicionarbola(x, y) {
            let bola = document.getElementById('bola');
            bola.style.left = x + '%';
            bola.style.top = y + '%';
        }

        function pegarhorizontal(bola) {
            let estiloBola = getComputedStyle(bola);
            let left = estiloBola.left.match(/(\d+)/);
            
            let labirinto = document.getElementById('labirinto'); 
            let larguraLabirinto = labirinto.clientWidth;
            
            let horizontal = (parseInt(left[1], 10) / larguraLabirinto) * 100;

            return horizontal; }

        function pegarvertical(bola) {
            let estiloBola = getComputedStyle(bola);
            let top = estiloBola.top.match(/(\d+)/);
            
            let labirinto = document.getElementById('labirinto'); 
            let alturaLabirinto = labirinto.clientHeight; 
            
            let vertical = (parseInt(top[1], 10) / alturaLabirinto) * 100; 
            
            return vertical;
        }

        function executar() {
            let numb = logb();
            let numc = logc();
            let numd = logd();
            let nume = loge();

            numb = (parseInt(numb[1], 10)) * 6; // cada 6% é aproximatamente 1 quadrado para cima
            numc = (parseInt(numc[1], 10)) * 6;
            numd = (parseInt(numd[1], 10)) * 5; // cada 5% é um quadrado para os lados
            nume = (parseInt(nume[1], 10)) * 5;

            console.log(numb);
            console.log(numc);
            console.log(numd);
            console.log(nume);

            let bola = document.getElementById('bola');
            
            let horizontal = pegarhorizontal(bola);
            let vertical = pegarvertical(bola);

            if (nume > numd) {horizontal += (nume - numd); console.log(horizontal) }
            else if (numd > nume) {horizontal -= (numd - nume); console.log(horizontal)}

            if (numc > numb) {vertical -= (numc - numb);console.log(vertical)}
            else if (numb > numc) {vertical += (numb - numc);console.log(vertical)}

            if (vertical < 4) {vertical=0}
            if (vertical > 93) {vertical=93}

            let mover = parede(horizontal,vertical);
            if (mover === true) {
                posicionarbola(horizontal, vertical); 
            }

            // Verifica se a bola chegou na saída do labirinto
            if (horizontal == 50 && vertical == 12) {
                console.log('pao')
                const anilab = {
                    elemento: document.getElementById('labirinto'),
                    totalImagens: 4, // Total de imagens para a animação
                    intervalo: 500, // Tempo em milissegundos entre cada imagem
                    imagemAtual: 0, // Índice da imagem atual
                };
                let i = 1;

                function atualizarImagem() {
                    labirinto.style.backgroundImage = 'url("../img/abrindo" + i + ".png")';
                    i = (i + 1) % anilab.totalImagens; // Vai de 0 a 4 e depois volta para 0
                    console.log('tempo')
                }

                setInterval(atualizarImagem, anilab.intervalo);
            }
        }
        </script>
    </body>
</html>
